<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>プレゼンタイムキーパー</title>
    <style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: transparent;
        overflow: hidden;
        user-select: none;
        margin: 0;
        padding: 0;
    }

    .timer-bar {
        position: fixed;
        right: 0;
        top: 0;
        width: 40px;
        height: 100vh;
        background: rgba(240, 240, 240, 0.95);
        border-left: 2px solid #ddd;
        display: flex;
        flex-direction: column;
        z-index: 10000;
        transition: width 0.3s ease;
    }

    .timer-bar:hover {
        width: 200px;
    }

    .progress-container {
        flex: 1;
        position: relative;
        margin: 60px 5px 20px 5px;
        background: #e0e0e0;
        border-radius: 15px;
        overflow: hidden;
    }

    .progress-fill {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        background: linear-gradient(to top, #4CAF50, #8BC34A);
        transition: height 0.1s ease, background 0.3s ease;
        border-radius: 0 0 15px 15px;
    }

    .progress-fill.warning {
        background: linear-gradient(to top, #FF9800, #FFC107);
    }

    .progress-fill.danger {
        background: linear-gradient(to top, #F44336, #FF5722);
        animation: pulse 1s infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
    }

    .controls {
        padding: 10px 5px;
        display: flex;
        flex-direction: column;
        gap: 5px;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .timer-bar:hover .controls {
        opacity: 1;
    }

    .time-input {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        text-align: center;
    }

    .btn {
        padding: 8px;
        border: none;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
        transition: background 0.2s ease;
        font-weight: bold;
    }

    .btn-start {
        background: #4CAF50;
        color: white;
    }

    .btn-start:hover {
        background: #45a049;
    }

    .btn-pause {
        background: #FF9800;
        color: white;
    }

    .btn-pause:hover {
        background: #e68900;
    }

    .btn-reset {
        background: #f44336;
        color: white;
    }

    .btn-reset:hover {
        background: #d32f2f;
    }

    .time-display {
        text-align: center;
        font-size: 12px;
        font-weight: bold;
        color: #333;
        margin: 5px 0;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .timer-bar:hover .time-display {
        opacity: 1;
    }

    .position-controls {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 2px;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .timer-bar:hover .position-controls {
        opacity: 1;
    }

    .pos-btn {
        width: 20px;
        height: 20px;
        border: none;
        border-radius: 3px;
        font-size: 10px;
        cursor: pointer;
        background: #666;
        color: white;
    }

    .pos-btn:hover {
        background: #333;
    }

    .pos-btn.active {
        background: #4CAF50;
    }

    /* 位置別のスタイル */
    .timer-bar.left {
        right: auto;
        left: 0;
        border-left: none;
        border-right: 2px solid #ddd;
    }

    .timer-bar.top {
        width: 100vw;
        height: 40px;
        flex-direction: row;
        border-left: none;
        border-bottom: 2px solid #ddd;
    }

    .timer-bar.top:hover {
        height: 100px;
        width: 100vw;
    }

    .timer-bar.top .progress-container {
        flex: 1;
        margin: 5px 60px 5px 20px;
        height: 30px;
    }

    .timer-bar.top .progress-fill {
        left: 0;
        bottom: auto;
        top: 0;
        height: 100% !important;
        width: 0%;
        border-radius: 15px 0 0 15px;
    }

    .timer-bar.bottom {
        width: 100vw;
        height: 40px;
        flex-direction: row;
        top: auto;
        bottom: 0;
        border-left: none;
        border-top: 2px solid #ddd;
    }

    .timer-bar.bottom:hover {
        height: 100px;
        width: 100vw;
    }

    .timer-bar.bottom .progress-container {
        flex: 1;
        margin: 5px 60px 5px 20px;
        height: 30px;
    }

    .timer-bar.bottom .progress-fill {
        left: 0;
        bottom: auto;
        top: 0;
        height: 100% !important;
        width: 0%;
        border-radius: 15px 0 0 15px;
    }
    </style>
    </head>
    <body>
        <div class="timer-bar" id="timerBar">
            <div class="position-controls">
                <button class="pos-btn" data-position="left">←</button>
                <button class="pos-btn" data-position="top">↑</button>
                <button class="pos-btn active" data-position="right">→</button>
                <button class="pos-btn" data-position="bottom">↓</button>
            </div>

            <div class="progress-container">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div class="controls">
                <div style="display: flex; align-items: center; gap: 5px;">
                    <input type="number" class="time-input" id="minutesInput" placeholder="分" min="0" max="999" value="5" style="width: 50px;">
                    <span style="color: #333;">:</span>
                    <input type="number" class="time-input" id="secondsInput" placeholder="秒" min="0" max="59" value="0" style="width: 50px;">
                </div>
                <div class="time-display" id="timeDisplay">05:00</div>
                <button class="btn btn-start" id="startBtn">開始</button>
                <button class="btn btn-pause" id="pauseBtn" style="display: none;">一時停止</button>
                <button class="btn btn-reset" id="resetBtn">リセット</button>
            </div>
        </div>

        <script>
            // Add IPC communication for Electron
            const { ipcRenderer } = require('electron');

            class PresentationTimer {
                constructor() {
                    this.totalTime = 0;
                    this.remainingTime = 0;
                    this.isRunning = false;
                    this.interval = null;
                    this.position = 'right';

                    this.initElements();
                    this.bindEvents();
                    this.updateDisplay();
                }

                initElements() {
                    this.timerBar = document.getElementById('timerBar');
                    this.progressFill = document.getElementById('progressFill');
                    this.minutesInput = document.getElementById('minutesInput');
                    this.secondsInput = document.getElementById('secondsInput');
                    this.timeDisplay = document.getElementById('timeDisplay');
                    this.startBtn = document.getElementById('startBtn');
                    this.pauseBtn = document.getElementById('pauseBtn');
                    this.resetBtn = document.getElementById('resetBtn');
                    this.positionBtns = document.querySelectorAll('.pos-btn');
                }

                bindEvents() {
                    this.startBtn.addEventListener('click', () => this.start());
                    this.pauseBtn.addEventListener('click', () => this.pause());
                    this.resetBtn.addEventListener('click', () => this.reset());
                    this.minutesInput.addEventListener('change', () => this.setTime());
                    this.secondsInput.addEventListener('change', () => this.setTime());

                    this.positionBtns.forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            this.setPosition(e.target.dataset.position);
                        });
                    });
                    
                    // Handle hover for window expansion
                    if (typeof ipcRenderer !== 'undefined') {
                        this.timerBar.addEventListener('mouseenter', () => {
                            ipcRenderer.send('expand-window', this.position, true);
                        });
                        
                        this.timerBar.addEventListener('mouseleave', () => {
                            ipcRenderer.send('expand-window', this.position, false);
                        });
                    }
                }

                setTime() {
                    const minutes = parseInt(this.minutesInput.value) || 5;
                    const seconds = parseInt(this.secondsInput.value) || 0;
                    this.totalTime = minutes * 60 + seconds;
                    this.remainingTime = this.totalTime;
                    this.updateDisplay();
                }

                start() {
                    if (!this.isRunning) {
                        if (this.remainingTime === 0) {
                            this.setTime();
                        }

                        this.isRunning = true;
                        this.startBtn.style.display = 'none';
                        this.pauseBtn.style.display = 'block';

                        this.interval = setInterval(() => {
                            this.remainingTime--;
                            this.updateDisplay();

                            if (this.remainingTime <= 0) {
                                this.finish();
                            }
                        }, 1000);
                    }
                }

                pause() {
                    this.isRunning = false;
                    this.startBtn.style.display = 'block';
                    this.pauseBtn.style.display = 'none';
                    clearInterval(this.interval);
                }

                reset() {
                    this.pause();
                    this.setTime();
                }

                finish() {
                    this.pause();
                    this.remainingTime = 0;
                    this.updateDisplay();

                    // 通知
                    if (Notification.permission === 'granted') {
                        new Notification('プレゼン時間終了', {
                            body: '設定した時間が経過しました',
                            icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="%23f44336"/></svg>'
                        });
                    }
                }

                updateDisplay() {
                    const elapsed = this.totalTime - this.remainingTime;
                    const progress = this.totalTime > 0 ? (elapsed / this.totalTime) * 100 : 0;

                    // プログレスバーの更新
                    if (this.position === 'top' || this.position === 'bottom') {
                        this.progressFill.style.width = progress + '%';
                        this.progressFill.style.height = '100%';
                    } else {
                        this.progressFill.style.height = progress + '%';
                        this.progressFill.style.width = '100%';
                    }

                    // 色の変更
                    this.progressFill.className = 'progress-fill';
                    if (progress > 80) {
                        this.progressFill.classList.add('danger');
                    } else if (progress > 60) {
                        this.progressFill.classList.add('warning');
                    }

                    // 時間表示の更新
                    const minutes = Math.floor(this.remainingTime / 60);
                    const seconds = this.remainingTime % 60;
                    this.timeDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                }

                setPosition(position) {
                    this.position = position;
                    this.timerBar.className = `timer-bar ${position}`;

                    // アクティブボタンの更新
                    this.positionBtns.forEach(btn => {
                        btn.classList.toggle('active', btn.dataset.position === position);
                    });

                    this.updateDisplay();
                    
                    // Notify main process about position change
                    if (typeof ipcRenderer !== 'undefined') {
                        ipcRenderer.send('change-position', position);
                    }
                }
            }

            // 通知許可の要求
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }

            // アプリの初期化
            const timer = new PresentationTimer();
        </script>
    </body>
</html>
